<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <link rel="icon" href="logo.png" type="image/x-icon" />
    <link href="logo.png" rel='apple-touch-icon' sizes='120x120' />
    <link href="logo.png" rel='apple-touch-icon' sizes='152x152' />
    <link href="logo.png" rel='shortcut icon' type='image/x-icon' />
    <title>Binary Bot Pro - Smart Auto Trading</title>
    <!-- <link rel="stylesheet" href="assets/style.css"> -->
    <link href="https://cdn.jsdelivr.net/npm/remixicon@4.5.0/fonts/remixicon.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css" rel="stylesheet" />
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        :root {
            --bg: #ffffff;
            --text: #333;
            --header: #1a202c;
            --box-bg: #edf2f7;
            --table-bg: white;
            --th-bg: #f8f9fa;
            --border: #e0e0e0;
            --hover: #f1f3f5;
        }

        body.dark-mode {
            --bg: #121212;
            --text: #e0e0e0;
            --header: #e0e0e0;
            --box-bg: #1e1e1e;
            --table-bg: #1a1a1a;
            --th-bg: #222;
            --border: #333;
            --hover: #1f1f1f;
        }

        * {
            font-family: Arial, "Segoe UI", sans-serif;
            touch-action: manipulation;
            /* font-size: 18px; */
        }

        body {
            margin: 0;
            padding: 16px;
            background: var(--bg);
            color: var(--text);
            transition: background 0.3s, color 0.3s;
            font-size: 14px;
            max-width: 800px;
            margin: 0 auto;
            background-color: #000
        }

        h1 {
            margin: 0;
            font-size: 20px
        }

        h2 {
            margin: 0;
            color: #000;
            font-size: 18px
        }
        h3 {
            margin: 0;
            color: #7d7d7d;
            font-size: 16px
        }

        input[type="text"], input[type="password"] {
            padding: 8px;
            /* width: 300px; */
            border: 1px solid #ccc;
            border-radius: 6px;
            background: white;
            color: black;
            
        }

        select {
            padding: 8px;
            /* width: 300px; */
            border: 1px solid #ccc;
            border-radius: 6px;
            background: white;
            color: black;
            cursor: pointer;
            font-size: 16px
        }


        button {
            padding: 12px 14px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s;
            font-size: 16px;
            font-weight: bold;
        }

        .txt-danger {
            color: #dc3545;
        }
        .txt-success {
            color: #28a745;
        }
        .primary {
            background-color: #007bff;
        }
        .primary:hover {
            background-color: #0056b3;
        }

        .danger {
            background-color: #dc3545;
        }
        .danger:hover {
            background-color: #b40819;
        }

        button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        label {
            font-weight: bold;
            color: #7d7d7d;
        }
        p {
            margin: 0;
        }

        .status-box {
            padding: 10px;
            background: var(--box-bg);
            border-left: 4px solid #007bff;
            margin-top: 10px;
            font-size: 16px;
            border-radius: 4px;
        }

        table {
            width: 100%;
            margin-top: 16px;
            border-collapse: collapse;
            background: var(--table-bg);
            box-shadow: 0 0 8px rgba(0, 0, 0, 0.05);
        }

        th,
        td {
            padding: 6px 16px;
            border-bottom: 1px solid var(--border);
            text-align: left;
        }

        th {
            background-color: var(--th-bg);
            font-weight: 600;
        }

        tr:hover {
            background-color: var(--hover);
        }

        .win {
            color: green;
            font-weight: bold;
        }

        .loss {
            color: red;
            font-weight: bold;
        }

        .header-box {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            flex-wrap: wrap;
        }

        .box {
            display: flex;
            flex-direction: column;
            /* border: 2px solid var(--border); */
            border-radius: 16px;
            padding: 16px;
            background: rgb(255, 255, 255);
            /* box-shadow: rgba(0, 0, 0, 0.1) 0px 1px 3px 0px, rgba(0, 0, 0, 0.06) 0px 1px 2px 0px */
            /* color: #00ff37; */
            
        }

        #connect {
            margin-top: 16px;
        }
        #start {
            margin-top: 16px;
        }
        #api-token {
            font-size: 16px;
        }

        .description {
            font-size: 12px;
            margin-top: 8px
        }
        .description p {
            margin: 6px 0;
        }
        ol {
            padding: 0 20px;
            margin: 0;
        }

        .container-box {
            display: flex;
            flex-wrap: wrap;
            grid-gap: 16px;
            overflow-x: auto;
        }
        .flex-1 {
            flex: 1
        }

        .mb-base {
            margin-bottom: 16px;
        }

        #tick-list {
            margin: 0;
            padding: 0;
        }
        input:disabled {
            color: #aaa;
            cursor: not-allowed;
        }

        #account-id, #balance {
            font-size: 24px;
            text-align: center;
            font-weight: bold;
            color: #007bff;
        }

        #trade-count, #winrate, #total-profit {
            font-size: 28px;
            text-align: center;
            font-weight: bold;
        }

        h1 {
            text-align: center;
            font-size: 32px;
            font-weight: bold;
        }
        .h2 {
            text-align: center;
            font-size: 28px;
            margin-bottom: 16px;
        }
        .img {
            max-width: 280px;
            width: 100%;
            margin: 0 auto;
            margin-bottom: 16px;
        }

        .d-none {
            display: none;
        }
        .fs-i {
            font-size: 22px;
        }
        .bd-box {
            border: 2px solid var(--border);
        }
        .toastify {
            font-size: 16px;
        }
.post-title {
    padding: 16px;
    font-size: 42px!important;
    color: #fff!important;
    text-shadow:
	  0 0 1px #fff,
      0 0 1px #fff,
      0 0 20px #fff,
      0 0 40px #0ff,
      0 0 80px #0ff;
}
p, li {
    margin: 0!important;
}	
.post-item-inner {
    background: black;
  	background-image: url(https://www.transparenttextures.com/patterns/3px-tile.png);
}
:root {
    --bg: #ffffff;
    --text: #333;
    --header: #1a202c;
    --box-bg: #edf2f7;
    --table-bg: white;
    --th-bg: #f8f9fa;
    --border: #e0e0e0;
    --hover: #f1f3f5;
}
* {
    font-family: Arial, "Segoe UI", sans-serif;
    touch-action: manipulation;
    /* font-size: 18px; */
}

h1 {
    margin: 0;
    font-size: 20px
}

h2 {
    margin: 0;
    color: #000;
    font-size: 18px
}
h3 {
    margin: 0;
    font-size: 16px
}

input[type="text"], input[type="password"] {
    padding: 8px;
    /* width: 300px; */
    border: 1px solid #ccc;
    border-radius: 6px;
    background: white;
    color: black;
    
}

select {
    padding: 8px;
    /* width: 300px; */
    border: 1px solid #ccc;
    border-radius: 6px;
    background: white;
    color: black;
    cursor: pointer;
    font-size: 16px
}


button {
    padding: 12px 14px;
    background-color: #007bff;
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    transition: background-color 0.3s;
    font-size: 16px;
    font-weight: bold;
}

.txt-danger {
    color: #dc3545;
}
.txt-success {
    color: #28a745;
}
.primary {
    background-color: #007bff;
}
.primary:hover {
    background-color: #0056b3;
}

.danger {
    background-color: #dc3545;
}
.danger:hover {
    background-color: #b40819;
}

button:disabled {
    background-color: #ccc;
    cursor: not-allowed;
}
label {
    font-weight: bold;
    color: #7d7d7d;
}
p {
    margin: 0;
}
.txt-muted {
	color: #7d7d7d;
}
.status-box {
    padding: 10px;
    background: var(--box-bg);
    border-left: 4px solid #007bff;
    margin-top: 10px;
    font-size: 16px;
    border-radius: 4px;
}

table {
  	font-size: 12px;
    width: 100%;
    margin-top: 16px;
    border-collapse: collapse;
    background: var(--table-bg);
    box-shadow: 0 0 8px rgba(0, 0, 0, 0.05);
    white-space: nowrap;
}

th,
td {
    padding: 0px 8px;
    border-bottom: 1px solid var(--border);
    text-align: left;
}

th {
    background-color: var(--th-bg);
    font-weight: 600;
}

tr:hover {
    background-color: var(--hover);
}

.win {
    color: green;
    font-weight: bold;
}

.loss {
    color: red;
    font-weight: bold;
}

.header-box {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin: 0;
    flex-wrap: wrap;
}

.box {
    display: flex;
    flex-direction: column;
    /* border: 2px solid var(--border); */
    border-radius: 15px;
    padding: 12px;
    background: rgb(255, 255, 255);
    /* box-shadow: rgba(0, 0, 0, 0.1) 0px 1px 3px 0px, rgba(0, 0, 0, 0.06) 0px 1px 2px 0px */
    /* color: #00ff37; */
    
}

#connect {
    margin-top: 16px;
}
#start {
    margin-top: 16px;
}
#api-token {
    font-size: 16px;
}

.description {
    font-size: 12px;
    margin-top: 8px
}
.description p {
    margin: 6px 0;
  	font-weight: bold;
}
ol {
    padding: 0 20px;
    margin: 0;
}

.container-box {
    display: flex;
    flex-wrap: wrap;
    grid-gap: 16px;
    overflow-x: auto;
}
.flex-1 {
    flex: 1
}

.mb-base {
    margin-bottom: 16px;
}

#tick-list {
    margin: 0;
    padding: 0;
}
input:disabled {
    color: #aaa;
    cursor: not-allowed;
}

#account-id, #balance {
    font-size: 24px;
    text-align: center;
    font-weight: bold;
    color: #007bff;
}

#trade-count, #winrate, #total-profit, #winloss, #max-dd, #lowest-session {
    font-size: 24px;
    text-align: center;
    font-weight: bold;
}

h1 {
    text-align: center;
    font-size: 32px;
    font-weight: bold;
}
.h2 {
    text-align: center;
    font-size: 28px;
    margin-bottom: 16px;
}
.img {
    max-width: 280px;
    width: 100%;
    margin: 0 auto;
    margin-bottom: 16px;
}

.d-none {
    display: none;
}
.fs-i {
    font-size: 22px;
  	font-weight: normal;
}
.bd-box {
    border: 1px solid var(--border);
}
.toastify {
    font-size: 16px;
}  
input {
    padding: 8px;
    /* width: 300px; */
    border: 1px solid #ccc;
    border-radius: 6px;
    background: white;
    color: black;
    cursor: auto;
    font-size: 16px;
}
.p-0 {
  	padding: 0;
}
.mt-base {
    margin-top: 8px;
}
.txt-small {
  	font-size: 12px;
    font-weight: normal;
}
.header-box h3 {
	font-size: 16px;
  	white-space: nowrap;
}
.header-box h2 {
  	color: black;
	font-size: 18px;
  	white-space: nowrap;
  	margin-bottom: 8px;
}
.fw-normal {
	font-weight: normal;  
}
.txt-primary {
  	color: #007bff;
}
  
  
   /* Modal styles */
    .modal {
      display: none; 
      position: fixed; 
      z-index: 9000; 
      left: 0; top: 0; width: 100%; height: 100%;
      background-color: rgba(0,0,0,0.5);
    }

    .modal-content {
      background-color: #fff;
      margin: 15% auto;
      padding: 20px;
      border-radius: 8px;
      width: 90%;
      text-align: center;
      position: relative;
    }

    .close-btn {
      position: absolute;
      top: 10px;
      right: 15px;
      cursor: pointer;
      font-weight: bold;
      font-size: 18px;
    }

    .btn {
      padding: 10px 20px;
      background: #007BFF;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    .btn:hover {
      background: #0056b3;
    }  
    </style>

</head>

<body>
    <h1 class="d-none">Binary Bot Pro</h1>
    <h2 class="h2 d-none">Smart Auto Trading</h2>
    <div class="img">
        <img src="header.webp" width="100%" />
    </div>

<div>
    <div class="box mb-base">
        <div class="header-box">
            <h2><i class="ri-key-2-line fs-i"></i> Deriv API Connection</h2>
        </div>

        <label for="api-token">API Token</label>
        <input id="api-token" type="password" placeholder="Enter your API token" value="XFOzhqtHz0gI04U" />
        <button class="primary custom-btn btn-animation" id="connect">Connect to Deriv</button>

        <div class="description">
            <p>To get your API token:</p>
            <ol>
                <li>Log in to your <a href="https://record.binary.com/_kHR1b8k0muStBVQhPcxVXGNd7ZgqdRLk/1/" target="_blank" rel="noopener noreferrer"
                        class="text-emerald-400 hover:underline">Deriv account</a></li>
                <li>Go to Settings &gt; API Token</li>
                <li>Create a new token with "Trade" permission</li>
                <li>Copy and paste the token here</li>
            </ol>
        </div>
    </div>

    <div class="box mb-base">
        <div class="header-box">

            <h2><i class="ri-lock-2-line fs-i"></i> Authorization</h2>
        </div>
        <div class="container-box">

            <div class="box flex-1 bd-box">
                <div class="header-box">
                    <h3>Account</h3>
                </div>
                <span id="account-id">â€”</span>
            </div>
            <div class="box flex-1 bd-box">
                <div class="header-box">
                    <h3>Balance</h3>
                </div>
                <span id="balance">â€”</span>
            </div>
        </div>
    </div>

    <div class="box mb-base">
        <div class="header-box">
            <h2><i class="ri-robot-2-line fs-i"></i> Trading Strategies</h2>
            <div></div>
        </div>

        <label for="api-token">Select</label>
        <select name="" id="strategy" disabled>
            <option value="RiseFall">HYIP</option>
        </select>
      	<div class="container-box mt-base">
          	<div class="box flex-1 p-0">
          		<label for="stake">Stake <span class="txt-small">(Minimum stake: 0.35$)</span></label>
            	<input type="decimal" min="0.35" step="0.01" id="stake" placeholder="Minimum stake 0.35$" value="2.1" oninput="updateInput(this)" disabled />
          	</div>
          	<div class="box flex-1 p-0">
                <label for="martingale">Martingale <span class="txt-small">(No martingale = 1)</span></label>
        		<input type="decimal" min="1" step="0.01" id="martingale" placeholder="No martingale is set to 1" value="10" oninput="updateInput(this)" disabled />
          	</div>
       
      
      	</div>
       
        <button class="primary custom-btn btn-animation" id="start" disabled>Start to Trade</button>
      

    </div>
  
    <div class="box">
        <div class="header-box">
            <h2><i class="ri-bar-chart-box-line fs-i"></i> Trade Results</h2>
            <div></div>
        </div>

        <div class="container-box mb-base">
            <div class="box flex-1 bd-box">
                <div class="header-box">
                    <h3>Trades</h3>
                </div>
                <span id="trade-count">â€”</span>
            </div>
            <div class="box flex-1 bd-box">
                <div class="header-box">
                    <h3>Win : Loss</h3>
                </div>
                <span id="winloss">â€”</span>
            </div>
            <div class="box flex-1 bd-box">
                <div class="header-box">
                    <h3>Win Rate</h3>
                </div>
                <span id="winrate">â€”</span>
            </div>
        </div>
      
      
      	<div class="container-box mb-base">

            <div class="box flex-1 bd-box">
                <div class="header-box">
                    <h3>Low.Balance</h3>
                </div>
                <span id="lowest-session">â€”</span>
            </div>
            <div class="box flex-1 bd-box">
                <div class="header-box">
                    <h3>Max.DD</h3>
                </div>
                <span id="max-dd">â€”</span>
            </div>
            <div class="box flex-1 bd-box">
                <div class="header-box">
                    <h3>Profit</h3>
                </div>
                <span id="total-profit">â€”</span>
            </div>
        </div>
      

        <!-- <div class="status-box"><strong>Status:</strong> <span id="status">Waiting...</span></div> -->
        <div class="container-box">
            <table id="results-table">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Contract ID</th>
                        <th>Type</th>
                        <th>Symbol</th>
                        <th>Stake</th>
                        <th>Profit/Loss</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>













    <script>
        let ws1, ws;
        let isAuthorized = false;
        let isConnect = false;
        let lastContractId = null;
        let tradeIndex = 1;
        let sessionProfit = 0;
        let sessionTrades = 0;
        let sessionWin = 0;
        let startAnalyzing = false;
        const connectButton = document.getElementById("connect");
        const tokenInput = document.getElementById("api-token");
        const token = tokenInput.value.trim();
        var i = 0;
        const symbol = ["R_10", "R_25", "R_50", "R_75", "R_100", "1HZ10V", "1HZ25V", "1HZ50V", "1HZ75V", "1HZ100V"];
        var maxDecimal = 0;
        var start_analyzing = true;
        const rootUrl = window.location.origin;
        //if (rootUrl !== "https://www.binarybot-pro.com") window.open("https://www.binarybot-pro.com", "_self");
        var initialStake;
      	var winStake;
		var martingale;

      
        document.getElementById("connect").addEventListener("click", () => authorize());
        document.getElementById("start").addEventListener("click", () => { selectedFunction() });


        function selectedFunction() {
            const select = document.getElementById("strategy");
            const funcName = select.value;          // gets selected option value
            if (typeof window[funcName] === "function") {
                window[funcName]();                    // calls the function dynamically
            } else {
                alert("Function not found.");
            }
        }

      
        function authorize() {
            if (!isConnect) {
                const token = tokenInput.value.trim();
                if (!token) {
                    return alert('Enter a valid API token.');
                }
                ws = new WebSocket('wss://ws.derivws.com/websockets/v3?app_id=1089');
                ws.onopen = () => ws.send(JSON.stringify({ authorize: token }));

                ws.onmessage = (event) => {
                    const data = JSON.parse(event.data);
                    if (data.msg_type === 'authorize') {
                      	//if (!data.authorize || !data.authorize.loginid) {
                        //    console.error("Authorize message missing loginid:", data);
                        //    return; // STOP â†’ prevents crash
                        //}
                        isConnect = true;
                        document.getElementById('account-id').textContent = data.authorize.loginid;
                        tokenInput.disabled = true;
                        connectButton.textContent = 'Disconnect';
                        connectButton.classList.remove('primary');
                        connectButton.classList.add('danger');
                        ws.send(JSON.stringify({ balance: 1, subscribe: 1 }));
                        notify("ðŸ¤– Deriv API Connected!", "3000", "#d1e7dd", "left");
                    }
                    if (data.msg_type === 'balance') {
                        document.getElementById('balance').textContent = parseFloat(data.balance.balance).toFixed(2);
                    }
                    document.getElementById('start').disabled = false;
                }
                document.getElementById('connect').disabled = false;
              	document.getElementById('strategy').disabled = false;
          		document.getElementById('stake').disabled = false;
          		document.getElementById('martingale').disabled = false;
                            
            } else {
                ws.close();
                isConnect = false;
                document.getElementById('api-token').disabled = false;
                document.getElementById('connect').textContent = 'Connect to Deriv';
                document.getElementById('account-id').textContent = 'â€”';
                document.getElementById('balance').textContent = 'â€”';
                document.getElementById('trade-count').textContent = '0';
                document.getElementById('total-profit').textContent = '0.00';
                document.getElementById('results-table').querySelector('tbody').innerHTML = '';
                document.getElementById('start').disabled = true;
                connectButton.classList.add('primary');
                connectButton.classList.remove('danger');
                notify("ðŸ¤– Deriv API Disconnected!", "3000", "#f8d7da", "left");

            }
          	initial();
        }
      
      	
        function updateInput(x) {
        	$('#' + x.id).val(x.value).attr('value', x.value);
          	initial();
        }
      
      
      	function initial() {
            initialStake = $('#stake').val();
      		winStake = initialStake;
      		martingale = $('#martingale').val();
        }

      
        function buyContract(type, symbol, stake, barrier, barrier2, duration, duration_unit) {
            if (type === "ACCU") {
                ws.send(
                    JSON.stringify({
                        buy: 1,
                        price: 300,
                        parameters: {
                            symbol: symbol,
                            amount: stake,
                            basis: "stake",
                            contract_type: type,
                            currency: "USD",
                            growth_rate: 0.01,
                            limit_order: {
                                take_profit: winStake,
                            },
                        },
                    })
                );
            } else if (type === "UPORDOWN") {
                ws.send(
                    JSON.stringify({
                        buy: 1,
                        price: 300,
                        parameters: {
                            symbol: symbol,
                            amount: stake,
                            basis: "stake",
                            contract_type: type,
                            barrier: barrier,
                            barrier2: barrier2,
                            currency: "USD",
                            duration: duration,
                            duration_unit: duration_unit,
                        },
                    })
                );
            } else if (barrier === "") {
              	ws.send(
                    JSON.stringify({
                        buy: 1,
                        price: 300,
                        parameters: {
                            symbol: symbol,
                            amount: stake,
                            basis: "stake",
                            contract_type: type,
                            currency: "USD",
                            duration: duration,
                            duration_unit: duration_unit,
                        },
                    })
                );
            } else {
                ws.send(
                    JSON.stringify({
                        buy: 1,
                        price: 300,
                        parameters: {
                            symbol: symbol,
                            amount: stake,
                            basis: "stake",
                            contract_type: type,
                            barrier: barrier,
                            currency: "USD",
                            duration: duration,
                            duration_unit: duration_unit,
                        },
                    })
                );
            }

        }


        function notify(text, duration, color, position) {
            Toastify({
                text: text,
                duration: duration,
                close: false,
                gravity: "bottom",
                position: position,
                style: {
                    background: color,
                    color: "black",
                    borderRadius: "8px",
                },

            }).showToast();
        }



        function getLastDigit(quote) {
            const normalized = Number(quote).toString();
            if (normalized.includes('.')) {
                if (normalized.split('.')[1].length > maxDecimal) {
                    maxDecimal = normalized.split('.')[1].length;
                }
            }
            const fixed = Number(quote).toFixed(maxDecimal);
            const lastChar = fixed.charAt(fixed.length - 1);
            return lastChar;
        }

        function getTick(quote) {
            const normalized = Number(quote).toString();
            if (normalized.includes('.')) {
                if (normalized.split('.')[1].length > maxDecimal) {
                    maxDecimal = normalized.split('.')[1].length;
                }
            }
            const fixed = Number(quote).toFixed(maxDecimal);
            return fixed;
        }

      
      
        function formatNumber(value) {
            const rounded = Math.round(value * 100) / 100;
            const parts = rounded.toString().split('.');
            if (!parts[1]) {
                return parts[0];
            }
            if (parts[1] === '0' || parts[1] === '00') {
                return parts[0];
            }
            if (parts[1][1] === '0' && parts[1].length === 2) {
                return rounded.toFixed(1);
            }
            return rounded.toFixed(2);
        }

      
      
        function autoRestart() {
            setTimeout(() => {
        //        start_analyzing = true;
                RiseFall();
            }, 1000);
        }

        //function safeCloseWS() {
        //    try { ws.close(); } catch(e) {}
        //    isAuthorized = false;
        //}
      

        //function wsSafeSend(data) {
        //    if (!ws || ws.readyState !== WebSocket.OPEN) {
        //        setTimeout(() => wsSafeSend(data), 100);
        //        return;
        //    }
        //    ws.send(JSON.stringify(data));
        //}
      
      
      
		var lowBalance = 0;
      	var lowBal = "<span>â€”</span>";
      	var maxDD = 0;
      	var maxDDTxt = "<span>â€”</span>";
      	var countMaxDD = 0;
        let lossStake = [];
        function addResultRow(poc) {
            const table = document.getElementById("results-table").querySelector("tbody");
            const row = document.createElement("tr");

            const profit = parseFloat(poc.profit);
            const statusText = profit > 0 ? "Win" : "Loss";
            const statusClass = profit > 0 ? "win" : "loss";
          
          	sessionProfit += profit;
            sessionTrades++;
          
            if (profit >= 0) {
                //i++;
                initialStake = winStake;
                sessionWin++;
                notify("ðŸ¤‘ Win $" + profit, "3000", "#a3cfbb", "right");
              	x = 1;
            } else {
                
                notify("ðŸ˜ž Loss $" + profit, "3000", "#f1aeb5", "right");
              
              	if (sessionProfit < lowBalance) {
                  	lowBalance = sessionProfit;
                  	if (lowBalance == 0) {
                     	lowBal = "<span>â€”</span>";
                    } else {
                      	lowBal = "<span class='txt-danger'>$" + formatNumber(lowBalance) + "</span>";
                    }
                    
                }
              
              	
              	initialStake = (initialStake * martingale).toFixed(2);
             	x = 2;

            }
			start_analyzing = true;
          	
          	if (!lossStake.includes(initialStake)) {
                lossStake.push(initialStake);
            }
            maxDD = lossStake.reduce((sum, i) => sum + (i * 1), 0);
            countMaxDD = lossStake.reduce((sum, i) => sum + 1, 0);
            if (maxDD == 0) {
              	maxDDTxt = "<span>â€”</span>";
            } else {
              	maxDDTxt = "<span>$" + formatNumber(maxDD) + "</span>";
            }

            // Add new data if not present
			//i++;
            //if (i == (symbol.length - 1)) {
            //    i = 0;
            //}
          	//maxDecimal = 0;



            if (sessionProfit > 0) {
                document.getElementById("total-profit").classList.remove('txt-danger');
                document.getElementById("total-profit").classList.add('txt-success');
            } else if (sessionProfit < 0) {
                document.getElementById("total-profit").classList.remove('txt-success');
                document.getElementById("total-profit").classList.add('txt-danger');
            }

            document.getElementById("total-profit").textContent = "$" + sessionProfit.toFixed(2);
            document.getElementById("trade-count").textContent = sessionTrades;
          	$("#winloss").html("<span class='txt-success'>" + sessionWin + "</span> <span class='txt-muted'>:</span> <span class='txt-danger'>" + (sessionTrades - sessionWin) + "</span>");
          	$("#lowest-session").html(lowBal);
          	$("#max-dd").html(maxDDTxt + " <span class='txt-muted'>(" + countMaxDD + ")</span>");
            document.getElementById("winrate").textContent = (sessionWin / sessionTrades * 100).toFixed(0) + "%";

            row.innerHTML = `
                    <td>${tradeIndex++}</td>
                    <td>${poc.contract_id}</td>
                    <td>${poc.contract_type}</td>
                    <td>${poc.display_name}</td>
                    <td>${poc.buy_price}</td>
                    <td class="${statusClass}">${profit.toFixed(2)}</td>
                    <td class="${statusClass}">${statusText}</td>
                `;
            table.insertBefore(row, table.firstChild);
          	predictor = getLastDigit(poc.exit_tick);
        }
      
      
      
      
    
      
      
      

        let tickPrices = [];
		var x = 1;
      	var match = 0;
      	var predictor = 0;
        function RiseFall() {

            if (!isAuthorized) {
                const token = tokenInput.value.trim();
                if (!token) {
                    return alert('Enter a valid API token.');
                }
                ws = new WebSocket('wss://ws.derivws.com/websockets/v3?app_id=1089');
                ws.onopen = () => ws.send(JSON.stringify({ authorize: token }));
                ws.onmessage = (event) => {
                    const data = JSON.parse(event.data);
                    if (data.msg_type === 'authorize') {
                      	if (!data.authorize || !data.authorize.loginid) {
							$("#start").trigger("click");
                            return; // STOP â†’ prevents crash
                        }
                        isAuthorized = true;
                        document.getElementById('account-id').textContent = data.authorize.loginid;
                        tokenInput.disabled = true;
                        connectButton.textContent = 'Disconnect';
                        ws.send(JSON.stringify({ balance: 1, subscribe: 1 }));
                        ws.send(JSON.stringify({ ticks: symbol[i], subscribe: 1 }));
                    }

                    if (data.msg_type === 'balance' && data.balance && typeof data.balance.balance !== 'undefined') {
                        document.getElementById('balance').textContent = parseFloat(data.balance.balance).toFixed(2);
                    }

                    if (data.msg_type === 'tick' && data.tick && typeof data.tick.quote !== 'undefined' && start_analyzing == true) {
                        const price = getTick(data.tick.quote);
                        const time = new Date(data.tick.epoch * 1000).toLocaleTimeString();
                        var dt = new Date(data.tick.epoch * 1000);
                        var hr = dt.getHours();
                        var m = "0" + dt.getMinutes();
                        var s = "0" + dt.getSeconds();

                      	if (x == 2) {
                        	if (data.tick) {

                                  const price = parseFloat(data.tick.quote.toFixed(3));
                                  tickPrices.push(price);
                                  if (tickPrices.length < 20) {
									  notify("ðŸ“ˆ [" + time + "] " + " Price Analyzing ... [" + getTick(data.tick.quote) + "]", "2000", "#cfe2ff", "left");
									  return;
								  }
                                  //const factor = 0.00613 * tickPrices[tickPrices.length-2] / 100;
								  //console.log(tickPrices, factor);
                                  //if (Math.abs(tickPrices[tickPrices.length-2]*1 - tickPrices[tickPrices.length-1]*1) >= factor) {
									  if ((Math.max(tickPrices[tickPrices.length-1]) == tickPrices[tickPrices.length-1]) && 
										  (tickPrices[tickPrices.length-1] > tickPrices[tickPrices.length-2]) && 
										  (tickPrices[tickPrices.length-2] > tickPrices[tickPrices.length-3]) && 
										  (tickPrices[tickPrices.length-3] > tickPrices[tickPrices.length-4]) && 
										  (tickPrices[tickPrices.length-4] > tickPrices[tickPrices.length-5])
										 ) {
											buyContract("UPORDOWN", "R_10", initialStake, "+0.126", "-1.570",  "2", "m");
										  //buyContract("CALL", "R_10", initialStake, "-0.5", "5", "t");
									  } else if ((Math.min(tickPrices[tickPrices.length-1]) == tickPrices[tickPrices.length-1]) && 
										  (tickPrices[tickPrices.length-1] < tickPrices[tickPrices.length-2]) && 
										  (tickPrices[tickPrices.length-2] < tickPrices[tickPrices.length-3]) && 
										  (tickPrices[tickPrices.length-3] < tickPrices[tickPrices.length-4]) && 
										  (tickPrices[tickPrices.length-4] < tickPrices[tickPrices.length-5])
									     ) {
										  
										  	buyContract("UPORDOWN", "R_10", initialStake, "+1.570", "-0.126",  "2", "m");
										  //buyContract("PUT", "R_10", initialStake, "+0.5", "5", "t");
									  }
                                  //}
                                 
                              }

                            // buyContract("PUT", "R_100", initialStake, "", "5", "t");

                            //if (data.tick) {
                            //    tickPrices.push(price);
							//	const n = tickPrices.length;
                                
                            //    if ((getLastDigit(tickPrices[n-1]) % 2 == 0) && (getLastDigit(tickPrices[n-2]) % 2 == 0) && (getLastDigit(tickPrices[n-3]) % 2 == 0) && (getLastDigit(tickPrices[n-4]) % 2 == 0) && (getLastDigit(tickPrices[n-5]) % 2 == 0) && (getLastDigit(tickPrices[n-6]) % 2 == 0)) {
                            //      buyContract("DIGITODD", "R_10", initialStake, "", "1", "t");
                            //    } else if ((getLastDigit(tickPrices[n-1]) % 2 == 1) && (getLastDigit(tickPrices[n-2]) % 2 == 1) && (getLastDigit(tickPrices[n-3]) % 2 == 1) && (getLastDigit(tickPrices[n-4]) % 2 == 1) && (getLastDigit(tickPrices[n-5]) % 2 == 1) && (getLastDigit(tickPrices[n-6]) % 2 == 1)) {
                            //      buyContract("DIGITEVEN", "R_10", initialStake, "", "1", "t");
                            //    }

                            //}
                          
                        } else if (x == 1) {
                          	if (data.tick && typeof data.tick.quote !== 'undefined') {
                              
                               //if (data.tick) {

                               //   const price = parseFloat(data.tick.quote.toFixed(3));
                               //   tickPrices.push(price);
                               //   if (tickPrices.length < 2) return; 
                               //   const factor = 0.00613 * tickPrices[tickPrices.length-2] / 100;
								  //console.log(tickPrices, factor);
                              //    if (Math.abs(tickPrices[tickPrices.length-2]*1 - tickPrices[tickPrices.length-1]*1) >= factor) {
                              //      buyContract("ACCU", "R_10", initialStake);
                              //    }
                                 
                              //}
                              
                              if (getLastDigit(data.tick.quote) == Math.floor(Math.random() * 10)) {
                                  buyContract("DIGITDIFF", symbol[i], initialStake, getLastDigit(data.tick.quote), "1", "t");
                              }
                              
                              
                              	//if (getLastDigit(data.tick.quote) == predictor) {
                                //	match = match + 1;
                                //} else {
                                //	match = 0;
                                //}
                              
                              	//if (match == 2) {
                                //  	buyContract("DIGITDIFF", "R_10", initialStake, "0", "1", "t");
                                //}
                              
                                //if (s.substr(-2) === "00") {
                                    //buyContract("UPORDOWN", "R_10", initialStake, "0.89",  "2", "m");
								      buyContract("UPORDOWN", "R_10", initialStake, "+0.126", "-1.570",  "2", "m");
                                //}
                              
                              	//if (s.substr(-2) === "00") {
                                //    buyContract("ACCU", "R_10", initialStake);
                                //}

                            }
                        }

                        //} 

                        //if (s.substr(-2) === "00") {
                        //    start_analyzing = true;
                        //}

                        //if (s.substr(-2) === "50") {
                        //    start_analyzing = false;
                        //}

                        notify("ðŸ“ˆ [" + time + "] " + " Price Analyzing ... [" + getTick(data.tick.quote) + "]", "2000", "#cfe2ff", "left");

                    }



                    if (data.msg_type === 'proposal_open_contract' && data.proposal_open_contract.contract_id === lastContractId) {
                        const poc = data.proposal_open_contract;
                        if (poc.is_sold) {
                            addResultRow(poc);
                            lastContractId = null;
                            ws.close();
                            isAuthorized = false;
                            start_analyzing = true;
                            tickPrices.length = 0
                            //setTimeout(() => { console.log("Waiting") }, 3000);
                            //$("#start").trigger("click");
                            //setTimeout(() => RiseFall(), 1000);
                            //addResultRow(poc);
                            //lastContractId = null;
                            //safeCloseWS();
                            //autoRestart();
                          
                            // Re-subscribe to ticks (keeps bot running)
                            //ws.send(JSON.stringify({
                            //    ticks: symbol[i], 
                            //    subscribe: 1
                            //}));

                            notify("ðŸ”„ Auto Restarting...", "3000", "#cfe2ff", "left");                            
                            RiseFall();
							//$("#start").trigger("click");
                        }
                    }


                    if (data.msg_type === 'buy' && data.buy?.contract_id) {
                        
                        lastContractId = data.buy.contract_id;
                        notify(`ðŸ“¢ Bought contract ID: ${lastContractId}`, "3000", "#9ec5fe", "right")
                        ws.send(JSON.stringify({
                            proposal_open_contract: 1,
                            contract_id: lastContractId,
                            subscribe: 1
                        }));
                        start_analyzing = false;
                        //ticks.length = 0;
                    }




                }

                document.getElementById('connect').disabled = true;
                document.getElementById('start').textContent = 'Stop to Trade';
              	document.getElementById('strategy').disabled = true;
          		document.getElementById('stake').disabled = true;
          		document.getElementById('martingale').disabled = true;
                document.getElementById('start').classList.remove('primary');
                document.getElementById('start').classList.add('danger');
                notify("ðŸ”¥ Starting a trading bot", "3000", "#cfe2ff", "left");
            } else {
                ws.close();
                isAuthorized = false;
                document.getElementById('connect').disabled = false;
                document.getElementById('start').textContent = 'Start to Trade';
                document.getElementById('start').classList.add('primary');
                document.getElementById('start').classList.remove('danger');
                document.getElementById('strategy').disabled = false;
          		document.getElementById('stake').disabled = false;
          		document.getElementById('martingale').disabled = false;
                notify("ðŸ’¤ Stopping a trading bot", "3000", "#cfe2ff", "left");
                //safeCloseWS();
                //notify("ðŸ’¤ Bot auto-restart", "3000", "#cfe2ff", "left");
                //autoRestart();
				//$("#start").trigger("click");
            }


        }
      
      
      
      
      
      
    </script>
    <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
</body>

</html>


